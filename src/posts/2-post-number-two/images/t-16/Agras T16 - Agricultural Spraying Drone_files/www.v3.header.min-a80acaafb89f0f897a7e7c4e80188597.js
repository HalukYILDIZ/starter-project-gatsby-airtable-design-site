"use strict";!function(){var e={animateFinish:!0,init:function(){this.handleNavbarHover(),this.handleDropdown(),this.handleTopPillsHover(),this.handleColumnItemClick()},handleNavbarHover:function(){$("#site-header").hover(function(){$(this).removeClass("collapsed")},function(){$(this).addClass("collapsed")})},handleDropdown:function(){var e=this,t=($("#site-header"),$("#siteHeaderNavbar .navbar-category")),n=t.find(".category-item");n.hover(function(){var n=$(this),a=n.find(".dui-dropdown-menu.full-screen,.dui-dropdown-menu.columns,.dui-dropdown-menu.single");if(a.length<=0)return t.find(".opened").removeClass("opened"),void t.find(".dui-dropdown-menu.full-screen").css("height","");if(!n.hasClass("opened")){var r=n.find(".dropdown-container").height(),i=t.find(".opened");i.length>0?(t.find(".dui-dropdown-menu.full-screen").css("height",""),t.find(".opened").removeClass("opened"),a.css("height",r)):(a.stop().css("height",0),e.animateFinish=!1,a.animate({height:r},300,function(){e.animateFinish=!0})),n.addClass("opened")}if(!n.data("load-lazyr")){var o=a.find("img[data-nav-lazyr]");o.each(function(e,t){var n=$(t);n.attr("src",n.attr("data-nav-lazyr"))}),n.data("load-lazyr",!0)}}),t.on("mouseleave",function(){t.find(".opened").removeClass("opened"),t.find(".dui-dropdown-menu.full-screen").stop().css("height","")})},handleTopPillsHover:function(){$(".nav-pills-top .enter-site").hover(function(){$(".nav-pills-top").addClass("enter-site-hover")},function(){$(".nav-pills-top").removeClass("enter-site-hover")})},handleColumnItemClick:function(){$(".column-item > a,.product-link > a").click(function(){/http/.test(this.href)&&($(".dui-dropdown-menu").css("display","none"),setTimeout(function(){$(".dui-dropdown-menu").css("display","")},300))})}};e.init()}();var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t){DUI.page({$nav:null,$navAccount:null,$navUser:null,$navCart:null,$searchForm:null,$searchBox:null,$searchInput:null,$searchBtn:null,$searchResultData:[],$currentPanelClass:"",$searchStorageKey:"",User:null,searchKeys:"",isSearching:!1,init:function(){this.$nav=t(".dui-navbar"),this.$navAccount=this.$nav.find(".nav-account"),this.$navUser=this.$nav.find(".nav-user"),this.$searchForm=this.$nav.find(".search-form"),this.$searchBox=this.$nav.find(".search-box"),this.$searchInput=this.$nav.find(".search-input"),this.$searchBtn=this.$searchBox.find(".search-btn"),this.$navCart=this.$nav.find(".nav-store"),this.$navLanguage=this.$nav.find(".nav-language"),this.requested_cart=!1,this.do_query_cart=!1,DUI.searchHelper=this.helper},ready:function(){DUI.Cookie.remove("www_redirect_to",{domain:DUI.Config.domain||".dji.com",path:"/"}),this.render(["renderAccount"]);var e=DUI.Cookie.get("cart_data_reload");"true"==e&&this.render("renderCarts"),this.$searchStorageKey="head-historical-search-list-"+(DUI.I18n.lang||"")},addViews:function(){var e=(t(".nav-store .btn-store .cart"),t(".nav-store .btn-store .count"),t(".nav-store .dui-dropdown-menu"));return{renderCarts:function(){var n=this,a=DUI.Cookie.get("cart_uuid")||"",r=DUI.Config.domain||".dji.com";n.do_query_cart=!0,DUI.queryCarts(a).submit(function(a){var i=a.data.first||{},o=i.quantity;if(n.quantity=o,o<=0)e.addClass("hidden");else{e.removeClass("hidden");var s=0,c=i.products&&i.products.length,l=n.$navCart.find(".total"),d=l.data("tmpl");t(".product-list li").remove(),t("#tpl-cart").render({getData:function(){return i=(i.products||[]).splice(0,3).map(function(e){return e.cover=e.variant.cover.mini,e.title=e.variant.title,e.product_url=DUI.I18n.store_url("product/"+e.variant.slug),s+=e.quantity,e})}}),c>3?l.text(d.replace("#",o-s)).removeClass("hidden"):l.addClass("hidden")}n.requested_cart=!0,n.do_query_cart=!1,DUI.Cookie.set("cart_data_qty",o||0,{domain:r,path:"/"}),DUI.Cookie.set("cart_data_reload","false",{domain:r,path:"/"})},function(t){e.addClass("hidden"),n.do_query_cart=!1,this.notice.error(t)})},renderAccount:function(){var e=this,n=DUI.Cookie.get("_logged")||"",a=e.User,r=DUI.Config.domain||".dji.com";if(DUI.Storage.removeItem("dji[user]"),!a&&"yes"==n){var i=DUI.Cookie.get("user_nick_name")||"",o="//www2.djicdn.com/assets/uploads/1db6b3ba6bee86b9eb54e37651072f84.svg";/(?:javascript|jav\s+ascript|\&#\d+|\&#x)/i.test(o)&&(o=""),a={success:!0,status:200,data:{first:{nick_name:i,avatar:o}}},e.User=a}if(n&&e.User){var s=a.data.first,r=location.hostname.replace("www","");e.$navUser.render({script:!1,getData:function(){var e="//www2.djicdn.com/assets/uploads/1db6b3ba6bee86b9eb54e37651072f84.svg";return s.avatar=s.avatar?"string"==typeof s.avatar?s.avatar:s.avatar.thumb.x2:e,s}}),s.nick_name?e.$navUser.find(".nick-name").removeClass("hidden"):localStorage.removeItem("dji[user]"),e.$navAccount.addClass("hidden"),e.$navUser.removeClass("hidden")}else{var c=DUI.Cookie.get("user_nick_name");c&&DUI.Cookie.remove("user_nick_name",{domain:r}),e.$navAccount.removeClass("hidden"),e.$navUser.addClass("hidden")}t([".login-link",".logout-link",".register-link"]).each(function(t,n){var a=e.$nav.find(n),r=a.attr("href")||"";r+=(r.indexOf("?")>-1?"&":"?")+"backUrl="+encodeURIComponent(location.href),a.attr("href",r)})}}},bind:function(){function e(e,t,n){var a;return function(){var r=this,i=arguments,o=function(){a=null,n||e.apply(r,i)},s=n&&!a;clearTimeout(a),a=setTimeout(o,t),s&&e.apply(r,i)}}function n(){var e=v.$searchInput.val().trim();v.searchKeys=e,g!=e&&(g=e,setTimeout(function(){v.searchKeys==e&&v.helper.getSearchHotWords(e,function(t){t&&v.searchKeys==e&&f(t)})},100))}function a(e){if("string"!=typeof e)throw Error("In replaceRedundantSlash(url), the url must be string");return e.split(/\/+/).reduce(function(e,t){return/:$/.test(e)?e+"//"+t:e+"/"+t})}function r(){var e="https://www.dji.com/";if(DUI&&DUI.Config&&DUI.Config.env){var t=DUI.Config.env;"production"===t?e="https://www.dji.com/":"development"===t||"preview"===t?e=window.location.origin.replace(/(coupon|citizenship|enterprise)\./,"www.")+"/":"staging"===t&&(e=window.location.origin.replace(/(coupon|citizenship|enterprise)\./,"wwww.")+"/")}return e}function i(e){var t=v.$searchResultData.autocomplete||[],n=t.filter(function(t){return t.id===e})[0],a=DUI.Storage.getItem(v.$searchStorageKey);a=JSON.parse(a)||[];var r=JSON.parse(JSON.stringify(a));if(r.map(function(t,n){if(t.id===e){var i=r.length-a.length;a.splice(n-i,1)}}),n&&"object"===("undefined"==typeof n?"undefined":_typeof(n))&&n.id&&(a.unshift(n),a.length>5&&a.pop(),a.length>0)){var i=JSON.stringify(a);DUI.Storage.setItem(v.$searchStorageKey,i)}}function o(e){var t,n=v.$currentPanelClass||".search-push",a=v.$searchBox.find(n+" li"),r=a.length,i=m;return!(r<=0)&&(i=i>=0?i+e-39+r:(r-(40-e)/2)%r,i=Math.abs(i%r),a.removeClass("active"),a.eq(i).addClass("active"),t=a.eq(i).hasClass("quick-link")?g:a.eq(i).text(),v.$searchInput.val(t),void(m=i))}function s(e,t){var n="",a=e.length;return e.forEach(function(e,r){var i=r+1+"-"+a;n+="string"==typeof e?l(e,i):c(e,i,t)}),n}function c(e,t,n){var a="https://";return t="history"===n?"history":t,'<li><a class="head-search-item ga-data" data-id="'+e.id+'" data-ga-category="head-search-'+n+'", data-ga-action="click", data-ga-label="search-item-rank-'+t+'" href="'+a+document.domain+"/"+DUI.I18n.lang+"/"+e.slug+"?site=brandsite&from="+n+'">'+e.title+"</a></li>"}function l(e,t){var n="https://";return'<li><a class="ga-data" data-ga-category="head-search-hotwords", data-ga-action="click", data-ga-label="search-item-rank-'+t+'" href="'+n+document.domain+"/"+DUI.I18n.lang+"/search?cache=no&q="+e+'&site=brandsite&from=hotwords">'+e+"</a></li>"}function d(e){var t=v.$searchBox.find(".history-words-list"),n=s(e,"history");t.find("li").remove(),t.html(n),""!==n&&p("history")}function h(e){for(var t=v.$searchBox.find(".marketing-words-list"),n="https://",a="",r=e.length,i=0;i<r;i++){var o=e[i].url.toLocaleLowerCase();o=o.replace(/^(https?:)?\/\//,n),DUI.helper.flowStats(),o=flowStats(o,"recommended");var s=i+1+"-"+r;a+='<li class="quick-link"><a class="ga-data" data-ga-category="head-search-recommended", data-ga-action="click", data-ga-label="search-item-rank-'+s+'" href="'+o+'">'+e[i].title+"</a></li>"}t.find("li").remove(),t.html(a),""!==a&&p("recommended")}function u(e){var t=(v.$searchInput.val().trim()||"",v.$searchBox.find(".hot-words-list")),n=s(e,"autocomplete");t.find("li").remove(),t.html(n),""!==n&&p("search")}function f(e){v.$searchResultData=e;var t=e.lucky_urls||[],n=e.hot_words||[];"en"===DUI.I18n.lang&&(n=e.autocomplete||[]);var a=v.$searchBox.find(".search-push");return v.$searchBox.find(".marketing-words"),v.$searchBox.find(".hot-words"),v.$searchBox.find(".history-words"),0==t.length&&0==n.length?(console.log("Opps，后台没有相关内容"),void a.hide()):(n.length>0?u(n):h(t),m=-1,void(v.isSearching&&a.slideDown(500)))}function p(e){var t={history:".history-words",recommended:".marketing-words",search:".hot-words"};for(var n in t)if(t.hasOwnProperty(n)){var a=v.$searchBox.find(t[n]);a.hide()}var r=t[e],i=v.$searchBox.find(r);i.show(),v.$currentPanelClass=r||"";var o=v.$searchBox.find(".search-push");o.show(),DUI.helper.initTopicalGaDynamic("search-push")}var v=this;this.requested_cart=!1;var m=-1,g="";v.$searchInput.keydown(function(e){var t=e.which;38!=t&&40!=t||(e.preventDefault(),o(t))}),t(".search-item").on("click",".head-search-item",function(){var e=t(this).data("id");i(e)}),t(".search-push").on("click",".clean-history-list",function(){return DUI.Storage.removeItem(v.$searchStorageKey),v.$searchInput.focus(),!1}),v.$searchInput.focus(function(e){var n=t(this).val().trim();if(!n){var a=DUI.Storage.getItem(v.$searchStorageKey);a=JSON.parse(a),a?d(a):v.helper.getSearchHotWords(n,function(e){e&&f(e)})}});var $=e(n,500,!1);return v.$searchInput.keyup(function(e){var t=e.which;return 38!=t&&40!=t&&void $()}),v.$searchForm.submit(function(){var e,t=v.$searchInput.val().trim();if(v.$searchInput.val(t),!t.trim())return!1;if(m>=0){var n=v.$searchBox.find(".search-push li").eq(m).find("a");e=n.attr("href");var o=n.data("id");return o&&i(o),window.open(a(e),"__this"),!1}return e=r()+DUI.Localize.getCountryUrlPrefix()+"/search?q="+t,window.open(a(e),"__this"),!1}),v.$searchBtn.click(function(){var e,t=v.$searchInput.val().trim();return v.$searchInput.val(t),!!t.trim()&&(m>=0?(e=v.$searchBox.find(".search-push li").eq(m).find("a").attr("href"),window.open(a(e),"__this"),!1):(e=r()+DUI.Localize.getCountryUrlPrefix()+"/search?q="+t,window.open(a(e),"__this"),!1))}),t(window).scroll(function(){t("#site-header").hasClass("navbar-searching")&&(v.$nav.removeClass("navbar-searching"),t("#siteHeaderSearch").stop().animate({opacity:0},300,function(){t(this).css("display","none")}),t("#siteHeaderNavbar").stop().animate({opacity:1},300,function(){t(this).css("display","")}),v.$searchBox.find(".search-push").hide(),v.$searchInput.val(""),v.isSearching=!1)}),v.$navCart.hover(function(){if(!v.do_query_cart){var e=DUI.Cookie.get("cart_data_reload"),t=DUI.Cookie.get("cart_data_qty");v.requested_cart&&"true"!=e&&t==v.quantity||v.render("renderCarts")}}),{searchOn:function(){v.$nav.addClass("navbar-searching"),t("#siteHeaderNavbar").stop().animate({opacity:0},300,function(){t(this).css("display","none")}),t("#siteHeaderSearch").stop().animate({opacity:1},300,function(){t(this).css("display","block"),window.setTimeout(function(){v.$searchInput.focus(),v.isSearching=!0},500)})},searchOff:function(){v.$nav.removeClass("navbar-searching"),t("#siteHeaderSearch").stop().animate({opacity:0},300,function(){t(this).css("display","none")}),t("#siteHeaderNavbar").stop().animate({opacity:1},300,function(){t(this).css("display","")}),v.$searchBox.find(".search-push").hide(),v.$searchInput.val(""),v.isSearching=!1}}},helper:{getSearchHotWords:function(e,n){var a=e||"";t.ajax({type:"GET",url:DUI.API._helper.getApi("searchHotWord"),data:{q:a,lang:DUI.I18n.lang},dataType:"json",success:function(e){n(e)},error:function(e,t){n(null)}})}}})}(window,jQuery),function(e,t){DUI.page({$siteFooter:null,$siteFooterLocale:null,$dropdown:null,$subscribeForm:null,$subscribeInput:null,$subscribeBtn:null,$subscribeTip:null,init:function(){this.$siteFooter=t("#site-footer"),this.$siteFooterLocale=this.$siteFooter.find(".footer-locale"),this.$dropdown=this.$siteFooter.find("#select-locale-dropdown"),this.$subscribeForm=this.$siteFooter.find("#footer-subscribe-form"),this.$subscribeInput=this.$subscribeForm.find(".form-input"),this.$subscribeBtn=this.$siteFooter.find("#footer-subscribe-btn"),this.$subscribeTip=this.$subscribeForm.find(".tip"),this.showRecord()},ready:function(){DUI.Cookie.remove("www_redirect_to",{domain:DUI.Config.domain||".dji.com",path:"/"}),t(".footer-change-country").length?this.helper.changeCountry.call(this):this.helper.changeLanguage.call(this)},bind:function(){function e(e,t){DUI.API._helper.ajaxWithCredent({method:"POST",url:a,data:e}).done(function(e){e&&200===e.status?window.ga&&ga("send","event","pc-footer","click","other-subscribe-success"):window.ga&&ga("send","event","pc-footer","click","other-subscribe-error"),n.$subscribeTip.html(n.$subscribeTip.data("success")),setTimeout(function(){n.$subscribeTip.html("")},3e3),t&&t(e)})}var n=this,a=DUI.API._helper.getApi("subscribe");t(".footer-locale").hover(function(){n.$dropdown.css("maxHeight","100vh")},function(){n.$dropdown.css("maxHeight","0")}),t(".footer-locale").click(function(){n.$dropdown.css("maxHeight","100vh")}),n.$dropdown.find(".active").click(function(){n.$dropdown.css("maxHeight","0")}),n.bindSelectCountry(),n.$subscribeInput.keyup(function(){var e=t(this).val();if(n.helper.isValidEmail(e))n.$subscribeBtn.addClass("is-valid"),n.$subscribeTip.html("");else{n.$subscribeBtn.removeClass("is-valid");var a=n.$subscribeTip.data("error");n.$subscribeTip.html(a)}}),n.$subscribeInput.blur(function(){n.$subscribeTip.html("")}),n.$subscribeBtn.click(function(){var t=n.$subscribeInput.val();if(n.helper.isValidEmail(t)){var a={email:t};return DUI.Config._csrf?(a._csrf=DUI.Config._csrf,e(a)):DUI.Activity.generateToken(function(t){a._csrf=t,e(a)})}n.$subscribeTip.html(n.$subscribeTip.data("error"))});var r=t(".footer-item:last").find(".footer-column:last");return r.after(t("#site-footer .subscribe")),t(".social-wechat").hover(function(){t(this).find(".popup").fadeIn(300)},function(){t(this).find(".popup").fadeOut(300)}),{}},bindSelectCountry:function(){var e=t(".footer-change-country"),n=t(".select-country");e.on("click",function(){n.show(),t("html").addClass("country-modal-open")}),n.find(".country-header--close").on("click",function(){return n.hide(),t("html").removeClass("country-modal-open"),!1}),n.find(".country-modal").on("click",function(){return n.hide(),t("html").removeClass("country-modal-open"),!1})},showRecord:function(){var e=DUI.Cookie.get("country")||"",n=DUI.Config.lang,a=t("#J_footer_record");"cn"!=e.toLowerCase()&&"cn"!=n||a.removeClass("hidden")},helper:{setLangInCookie:function(e,t){DUI.Localize.subSetLangInCookie(e)},changeLanguage:function(){var e,n=this,a=n.$siteFooterLocale.find(".change-language"),r=[],i=[],o="",s=location.origin,c=location.hostname.split(".")[0]||"",l={coupon:["/en","/cn"],citizenship:["/en","/cn"],enterprise:[]};DUI.Config.enterprise_lang&&DUI.Config.enterprise_lang.forEach(function(e){/^\/.*/g.test(e)?l.enterprise.push(e):l.enterprise.push("/"+e)}),c=c.replace(/^r-/,"");for(var d=0,h=a.length;d<h;d++){var u="/"+a.eq(d).data("lang");r.push(u),"/en"!==u&&i.push(u)}if("/"==o)o="";else{var f=new RegExp("^("+i.join("|")+")","g");o=o.replace(f,"")}for(var p=0,v=a.length;p<v;p++){var m="/en"==r[p]?"":r[p];e=s+m+o,a.eq(p).attr("href",e),l[c]&&l[c].indexOf(r[p])<0&&a.eq(p).closest("li").hide()}return n.$siteFooterLocale.delegate(".change-language","click",function(e){e.preventDefault();var a=t(this).data("lang");if(n.helper.setLangInCookie.call(n,a),"_top"==t(this).attr("target"))top.location.href=t(this).attr("href");else{var r=t(this).attr("href");window.location.href=r}}),r},changeCountry:function(){t(".countrybox").on("scroll",function(e){return e.preventDefault(),!1}),t(".countrylist--item").on("click",function(e){e.preventDefault();var n=t(this).data("country"),a=t(this).data("locale"),r=t(this).data("continent");if("international"===r&&"us"===n&&"en"===a?DUI.Localize.setOtherRegionFlag():DUI.Localize.resetOtherRegionFlag(),DUI.Localize.setPairedLocalize({country:n,locale:a})){var i=DUI.Localize.getCountryUrlPrefix({locale:a,country:n})||"/";"_top"==t(this).attr("target")?top.location.href=i:window.location.href=i}})},getStoreLang:function(e){var t=DUI.Config.langMap;return t[e]?t[e]:t.en},isValidEmail:function(e){var t=/^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*\.){1,63}[a-z0-9]+$/;return t.test(e)}}})}(window,jQuery);